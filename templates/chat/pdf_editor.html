{% extends 'base.html' %}
{% block title %}Éditeur fidèle PDF - DocMind{% endblock %}
{% block extra_css %}
<style>
    .pdf-editor-container {
        width: 100vw;
        min-height: 100vh;
        background: #f5f6fa;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .editor-toolbar {
        background: #667eea;
        color: white;
        padding: 18px 32px;
        font-size: 1.2rem;
        font-weight: 700;
        width: 100%;
        box-shadow: 0 2px 8px rgba(102,126,234,0.12);
        display: flex;
        align-items: center;
        gap: 18px;
    }
    .pdf-html-content {
        margin: 32px auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.10);
        padding: 32px;
        width: 90vw;
        max-width: 1100px;
        overflow-x: auto;
    }
    .pdf-document {
        width: 100%;
    }
    .pdf-page {
        margin-bottom: 40px;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        background: #fff;
        position: relative;
        overflow: visible;
    }
    .text-span {
        cursor: pointer;
        transition: background 0.2s;
    }
    .text-span.selected {
        background: #ffe082;
    }
    .pdf-image {
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-radius: 4px;
    }
    .pdf-tables-section {
        margin-top: 32px;
    }
    .pdf-table-wrapper {
        overflow-x: auto;
        margin-bottom: 32px;
    }
    .pdf-table-wrapper table {
        background: white;
    }
</style>
{% endblock %}
{% block content %}
<div class="pdf-editor-container">
    <div class="editor-toolbar">
        <span><i class="bi bi-pencil-square"></i> Éditeur fidèle du PDF</span>
        <a href="{% url 'chat:conversation_detail' conversation.id %}" class="btn btn-outline-light btn-sm ms-3"><i class="bi bi-arrow-left"></i> Retour</a>
    </div>
    <div class="pdf-html-content" id="pdfHtmlContent">
        {{ pdf_html|safe }}
        {% if document and document.tables %}
            <div class="pdf-tables-section">
                <h3>Tableaux extraits</h3>
                {% for table in document.tables %}
                    <div class="pdf-table-wrapper" style="overflow-x:auto; margin-bottom:32px;">
                        <table class="table table-bordered table-striped" style="background:white;">
                            <tbody>
                                {% for row in table.rows %}
                                    <tr>
                                        {% for cell in row %}
                                            <td>{{ cell }}</td>
                                        {% endfor %}
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
// Sélection de texte (exemple simple)
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.text-span').forEach(function(span) {
        span.addEventListener('click', function() {
            document.querySelectorAll('.text-span.selected').forEach(function(s) {
                s.classList.remove('selected');
            });
            this.classList.add('selected');
            // TODO: Envoyer la sélection au backend pour annotation/action
        });
    });
});
</script>
{% endblock %}
